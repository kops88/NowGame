# 人生卷轴 · 主界面数据模型（Dart）

```dart
/// 核心约定：
/// - 所有进度均为 [0.0, 1.0] 区间的小数，表示百分比。
/// - 金额统一使用最小货币单位（如分、厘）以避免小数误差。
/// - 时间统一使用 DateTime（UTC 或本地由上层统一规范）。

/// 顶层聚合模型：主界面六大模块的数据快照
class DashboardModel {
  /// 时间模块（五层嵌套进度环）
  final TimeModule time;

  /// 健康模块（健康分与情绪分折线用的序列与统计）
  final HealthCardData health;

  /// 智慧模块（技能与经验值）
  final WisdomModule wisdom;

  /// 金钱模块（薪资/余额等摘要）
  final MoneySummary money;

  /// 影响力模块（锁定状态与门槛）
  final InfluenceStatus influence;

  /// 主线任务模块（任务列表与统计）
  final MainQuestModule mainQuest;

  DashboardModel({
    required this.time,
    required this.health,
    required this.wisdom,
    required this.money,
    required this.influence,
    required this.mainQuest,
  });
}

// -----------------------------
// 通用值对象
// -----------------------------

/// 本地时间（不含日期），用于每日重置等配置
class LocalTime {
  /// 小时，取值 [0, 23]
  final int hour;

  /// 分钟，取值 [0, 59]
  final int minute;

  const LocalTime({required this.hour, required this.minute});
}

/// 通用数值时间点，用于折线图/趋势图
class MetricPoint {
  /// 时间戳（建议以日为粒度用于健康/情绪，或更高频用于专注时长）
  final DateTime time;

  /// 数值（如健康分、情绪分、分钟数等）
  final double value;

  const MetricPoint({required this.time, required this.value});
}

/// 金额值对象（使用最小货币单位，避免浮点误差）
class Money {
  /// ISO 货币代码（如 "CNY"、"USD"）
  final String currencyCode;

  /// 金额最小单位（如分）：例如 12345 表示 ¥123.45
  final int amountMinorUnits;

  const Money({required this.currencyCode, required this.amountMinorUnits});
}

// -----------------------------
// 时间 Time（五层嵌套进度环）
// -----------------------------

/// 时间配置：用于计算生命周期与每日重置
class TimeConfig {
  /// 出生日期（用于计算人生进度）
  final DateTime birthDate;

  /// 预期寿命（单位：年），用于人生环的总长度
  /// @Modify 希望 预期寿命 可以因为健康因素而被修改, 不是用final
  /// @Modify 希望添加一个接口: 将预期寿命的天数转到预期寿命年数
  int expectedLifespanYears;

  /// @Modify 每日重置时间
  final LocalTime dayResetTime;

  const TimeConfig({
    required this.birthDate,
    required this.expectedLifespanYears,
    required this.dayResetTime,
  });
}

/// 时间进度快照（对应五层环）
class TimeProgressSnapshot {
  /// 当前时间（生成快照的时间点）
  final DateTime now;

  /// 人生进度（最外层）
  /// @Modify 使用当前离出生日期的天数 / 预期寿命天数
  final double lifeProgress;

  /// 年进度
  /// @Modify 使用当前离1月1日的天数 / 今年天数
  final double yearProgress;

  /// 月进度
  /// @Modify 使用当前日期 / 本月天数
  final double monthProgress;

  /// 周进度（以周一为起点或由上层约定）
  /// @Modify 当前星期数 / 7

  final double weekProgress;

  /// 日进度（受 dayResetTime 影响）
  /// @Modify 当前时间的在24小时的百分比. 在晚上0点刷新
  final double dayProgress;

  const TimeProgressSnapshot({
    required this.now,
    required this.lifeProgress,
    required this.yearProgress,
    required this.monthProgress,
    required this.weekProgress,
    required this.dayProgress,
  });
}

/// 时间模块聚合
class TimeModule {
  /// 配置（相对稳定）
  final TimeConfig config;

  /// 动态进度快照（用于绘制 5 环）
  final TimeProgressSnapshot snapshot;

  const TimeModule({required this.config, required this.snapshot});
}

// -----------------------------
// 健康 Health（健康折线 + 统计；情绪可复用）
// -----------------------------

/// 健康卡片数据
class HealthCardData {
  /// 健康分时序（建议每日 1 点），范围建议 [0, 100]
  final List<MetricPoint> healthScores;

  /// 情绪/幸福度时序（可选），范围建议 [0, 100]
  final List<MetricPoint>? moodScores;

  /// 健康分统计：平均值
  final double averageScore;

  /// 健康分统计：最高值
  final double maxScore;

  /// 健康分统计：最低值
  final double minScore;

  const HealthCardData({
    required this.healthScores,
    this.moodScores,
    required this.averageScore,
    required this.maxScore,
    required this.minScore,
  });
}

// -----------------------------
// 智慧 Wisdom（技能与经验值）
// -----------------------------

/// 单个技能的数据模型
class WisdomSkill {
  /// 技能唯一标识（如 "english_speaking"）
  final String id;

  /// 技能名称（如 “英语口语”）
  final String name;

  /// 当前技能等级（Lv.）
  final int level;

  /// 距离下一级所需经验的当前值（如 80）
  final int currentXp;

  /// 升级所需的总经验（如 100），用于计算百分比 currentXp / nextLevelXp
  final int nextLevelXp;

  /// 技能历史累计总经验（用于展示或成就）
  final int totalXp;

  /// 最近一次变更时间（打卡/增长发生时更新）
  final DateTime updatedAt;

  const WisdomSkill({
    required this.id,
    required this.name,
    required this.level,
    required this.currentXp,
    required this.nextLevelXp,
    required this.totalXp,
    required this.updatedAt,
  });
}

/// 智慧模块聚合（折叠/展开逻辑由 UI 控制）
class WisdomModule {
  /// 当前修炼中的技能集合
  final List<WisdomSkill> activeSkills;

  const WisdomModule({required this.activeSkills});
}

// -----------------------------
// 金钱 Wealth（金钱摘要小卡片）
// -----------------------------

/// 金钱摘要
class MoneySummary {
  /// 月薪（卡片主文案用）
  final Money monthlySalary;

  /// 当前余额（可选，预留拓展）
  final Money? currentBalance;

  const MoneySummary({
    required this.monthlySalary,
    this.currentBalance,
  });
}

// -----------------------------
// 影响力 Influence（锁定状态/等级门槛）
// -----------------------------

/// 影响力状态
class InfluenceStatus {
  /// 是否锁定（为 true 时卡片显示灰态/“Lv.X 解锁”）
  final bool locked;

  /// 当前等级（如 7）
  final int currentLevel;

  /// 解锁所需等级（如 10）
  final int requiredLevelToUnlock;

  /// 锁定原因或提示（可选，如“完成 3 个主线 Lv.10 解锁”）
  final String? lockReason;

  const InfluenceStatus({
    required this.locked,
    required this.currentLevel,
    required this.requiredLevelToUnlock,
    this.lockReason,
  });
}

// -----------------------------
// 主线任务 Main Quest（进度条/倒计时/趋势与热力图）
// -----------------------------

/// 子任务（可勾选）
class SubQuest {
  /// 子任务唯一标识
  final String id;

  /// 描述文案
  final String title;

  /// 是否完成
  final bool done;

  const SubQuest({required this.id, required this.title, required this.done});
}

/// 任务完成记录（用于经验掉落日志）
class QuestLogEntry {
  /// 发生时间
  final DateTime time;

  /// 获得的智慧经验（如 +10）
  final int wisdomXp;

  /// 获得的健康值（如 +5）
  final int healthScore;

  /// 备注（可选）
  final String? note;

  const QuestLogEntry({
    required this.time,
    required this.wisdomXp,
    required this.healthScore,
    this.note,
  });
}

/// 专注时长会话（用于统计曲线与热力图）
class FocusSession {
  /// 会话开始时间
  final DateTime start;

  /// 持续时长（分钟）
  final int minutes;

  const FocusSession({required this.start, required this.minutes});
}

/// 热力图单元（按天聚合的强度值）
class HeatmapCell {
  /// 日期（仅日期维度，时间部分建议置零）
  final DateTime date;

  /// 强度值（可取累计分钟或归一化等级）
  final int intensity;

  const HeatmapCell({required this.date, required this.intensity});
}

/// 任务统计（便于详情页直接渲染）
class QuestStats {
  /// 专注时长折线图数据（如按日聚合的分钟数）
  final List<MetricPoint> focusTrend;

  /// 打卡热力图（按天的强度）
  final List<HeatmapCell> contributions;

  const QuestStats({
    required this.focusTrend,
    required this.contributions,
  });
}

/// 主线任务实体
class Quest {
  /// 任务唯一标识
  final String id;

  /// 任务名称（如 “减脂 10 斤”）
  final String name;

  /// 图标键或资源标识（可选，UI 自行映射）
  final String? iconKey;

  /// 截止日期（用于倒计时，空表示无截止）
  final DateTime? dueDate;

  /// 已完成步骤数（用于总体进度条）
  final int completedSteps;

  /// 总步骤数
  final int totalSteps;

  /// 子任务清单
  final List<SubQuest> subQuests;

  /// 经验/健康掉落记录
  final List<QuestLogEntry> logs;

  /// 原始专注会话（可由上层聚合为曲线与热力图）
  final List<FocusSession> focusSessions;

  /// 预计算统计（可选，避免详情页重复聚合）
  final QuestStats? stats;

  const Quest({
    required this.id,
    required this.name,
    this.iconKey,
    this.dueDate,
    required this.completedSteps,
    required this.totalSteps,
    required this.subQuests,
    required this.logs,
    required this.focusSessions,
    this.stats,
  });
}

/// 主线任务模块聚合
class MainQuestModule {
  /// 主线任务列表（卡片列表数据源）
  final List<Quest> quests;

  const MainQuestModule({required this.quests});
}
```
